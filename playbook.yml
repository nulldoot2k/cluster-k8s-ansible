---
- name: Checking Host Information
  hosts: ["{{ user_input if user_input != '' else 'all' }}"]
  gather_facts: false
  roles:
    - { role: checking-hosts, tags: always,checking-hosts }
  vars_prompt:
    - name: user_input
      prompt: "Enter the group name in hosts (or press Enter for 'all' to ignore)"
      default: "{{ groups | join(',') }}"
      private: no

- name: Ensure tests
  hosts: [ master ] 
  become: true
  roles:
    - { role: tests, tags: hello }

- name: Ensure Nginx
  hosts: [ lb ] 
  become: true
  roles:
    - { role: loadbalancer, tags: nginx,uninstall-nginx }

- name: Ensure common
  hosts: [ cluster ] 
  become: true
  roles:
    - { role: common, tags: common }
    - { role: containerd, tags: docker }

- name: Deploy Cluster K8s
  hosts: [cluster]
  become: true
  roles:
    - { role: kubernetes, tags: k8s,uninstall-cluster }

- name: Setup Component
  hosts: [master]
  become: true
  roles:
    - { role: cni, tags: cni-flannel,cni-calico }
    - { role: cert-manager, tags: cert }
    - { role: metallb, tags: metallb }
    - { role: ingress-nginx, tags: ingress }

- name: Setup NFS
  hosts: [master:cluster]
  become: true
  roles:
    - { role: nfs, tags: nfs }
