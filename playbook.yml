---
- name: Checking Host Information
  hosts: ["{{ user_input if user_input != '' else 'all' }}"]
  gather_facts: false
  tags: [checking-hosts]
  roles:
    - { role: checking-hosts }
  vars_prompt:
    - name: user_input
      prompt: "Enter the group name in hosts (or press Enter for 'all' to ignore)"
      default: "{{ groups | join(',') }}"
      private: no

- name: Ensure tests
  tags: [ hello ]
  hosts: [ master ] 
  become: true
  roles: [ tests ]

- name: Ensure Nginx
  hosts: [ lb ] 
  become: true
  roles:
    - { role: loadbalancer, tags: nginx,uninstall-nginx }

- name: Ensure common
  tags: [ common ]
  hosts: [ cluster ] 
  become: true
  roles: [ common ]

- name: Ensure docker
  tags: ['docker']
  hosts: [cluster]
  become: true
  roles: [ containerd ]

- name: Deploy Cluster K8s
  tags: [k8s,uninstall-cluster]
  hosts: [cluster]
  become: true
  roles: [kubernetes]

- name: Setup Component
  hosts: [master]
  become: true
  roles:
    - { role: cni, tags: cni-flannel,cni-calico }
    - { role: cert-manager, tags: cert }
    - { role: metallb, tags: metallb }
    - { role: ingress-nginx, tags: ingress }

- name: Setup NFS
  hosts: [all]
  become: true
  roles:
    - { role: nfs, tags: nfs }
